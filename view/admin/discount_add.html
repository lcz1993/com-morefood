<style>
    .hide{
        display: none;
    }
</style>
<div class="modal-dialog ">
    <form method="post" class="form-horizontal" action="/admin/discount/add" data-validate="parsley">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">{{controller.meta_title}}</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="col-sm-3 control-label">优惠券名称</label>
                    <div class="col-sm-9">
                        <div class="row">
                            <div class="col-md-8 ">
                                <input type="text" name="name" class="input-sm form-control" placeholder="优惠券名称" data-required="true">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">开始时间</label>
                    <div class="col-sm-9">
                        <div class="row">
                            <div class="col-md-8 ">
                                <input type="text" name="start_time" class="input-sm form-control date" placeholder="使用期限开始时间">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">结束时间</label>
                    <div class="col-sm-9">
                        <div class="row">
                            <div class="col-md-8 ">
                                <input type="text" name="end_time" class="input-sm form-control date" placeholder="使用期限结束时间">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">优惠券状态</label>
                    <div class="col-sm-9">
                        <div class="row">
                            <div class="col-md-8 ">
                                <label>正常</label>
                                <input type="radio" name="status" value="0" checked="checked" />
                                <label>过期</label>
                                <input type="radio" name="status" value="1"/>    <!--默认选中-->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">默认展示</label>
                    <div class="col-sm-9">
                        <div class="row">
                            <div class="col-md-8 ">
                                <label>是</label>
                                <input type="radio" name="is_show" value="0"/>
                                <label>否</label>
                                <input type="radio" name="is_show" value="1" checked="checked" />    <!--默认选中-->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">优惠券种类</label>
                    <div class="col-sm-9">
                        <div class="row">
                            <div class="col-md-8 ">
                                <select class="form-control input-sm" name="type" onchange="show()" id="type">
                                    <option value="" selected>-=-请选择-=-</option>
                                    {% for index, item in config.setupapp.DISCOUNT_TYPE%}
                                    <option value="{{index}}">{{item}}</option>
                                    {% endfor %}
                                    <!--<option value="4" >满赠</option>-->
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group " id="percent">
                    <label class="col-sm-3 control-label">折扣</label>
                    <div class="col-sm-9">
                        <div class="row">
                            <div class="col-md-8 ">
                                <input type="text" name="percent" class="input-sm form-control number" placeholder="打折倍数">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="hide" id="discount_1">
                    <div class="form-group hide " id="min_price">
                        <label class="col-sm-3 control-label">满</label>
                        <div class="col-sm-9">
                            <div class="row">
                                <div class="col-md-8 ">
                                    <input type="text" name="min_price" class="input-sm form-control number" placeholder="满">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group " id="cut_price">
                        <label class="col-sm-3 control-label">减</label>
                        <div class="col-sm-9">
                            <div class="row">
                                <div class="col-md-8 ">
                                    <input type="text" name="cut_price" class="input-sm form-control number" placeholder="减">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="hide" id="discount_2">
                    <div class="form-group" id="dish_class">
                        <label class="col-sm-3 control-label">分类</label>
                        <div class="col-sm-9">
                            <div class="row">
                                <div class="col-md-8 ">
                                    <select class="form-control input-sm" name="type" onchange="showMedu()" id="dish_class_list">

                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" id="medu_div">
                        <label class="col-sm-3 control-label">分类</label>
                        <div class="col-sm-9">
                            <div class="row">
                                <div class="col-md-8 ">
                                    <select class="form-control input-sm" name="type" id="medu_select">

                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">单品特价</label>
                        <div class="col-sm-9">
                            <div class="row">
                                <div class="col-md-8 ">
                                    <input type="text" name="origin_price" class="input-sm form-control number" placeholder="单品特价">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <a href="javascript:;" class="btn btn-default" data-dismiss="modal">关闭</a>
                <button class="btn btn-primary btn-s-md ajax-post" type="submit" target-form="form-horizontal">确定</button>
            </div>
        </div><!-- /.modal-content -->
    </form>
</div><!-- /.modal-dialog -->
<script src="/static/admin/js/datepicker/bootstrap-datetimepicker.min.js" type="text/javascript"></script>
<script src="/static/admin/js/datepicker/locales/bootstrap-datetimepicker.zh-CN.js" type="text/javascript"></script>
<script>
    $(function () {
        $('.date').datetimepicker({
            format: 'yyyy-mm-dd HH:ii:ss',
            language:"zh-CN",
            minView:2,
            autoclose:true
        });
    })
    function show() {
        var type = $('#type option:selected').val();
        if(parseInt(type) === 1){
            //新用户优惠

        }else if(parseInt(type) === 2){
            //特价商品
            getDishClass();

        }else if(parseInt(type) === 3){
            //下单立减

        }else if(parseInt(type) === 4){
            //赠品优惠

        }else if(parseInt(type) === 5){
            //下单返红包

        }else if(parseInt(type) === 6){
            //进店领红包

        }
    }
    function getDishClass() {
        $('dish_class_list').empty();
        $.ajax({
            url:'/admin/dishclass/list',
            type:'get',
            success:function (res) {
                console.log(res);
                if(res.errno == 0){
                    var dishClassList = res.data;
                    var dish = '';
                    for(var i in dishClassList){
                        var dishClass = dishClassList[i];
                        dish += '<option value="'+dishClass.id+'">'+dishClass.name+'</option>';
                    }
                    var $dish = $(dish);
                    $('#dish_class_list').append($dish);
                }
            },
            fail:function () {
                console.log('fail');
            }
        })
    }
    function showMedu(){
        $('#medu_select').empty();
        var id = $('#dish_class_list option:selected').val();
        $.ajax({
            url:'/admin/medu/list?dishClassId='+id,
            type:'get',
            success:function (res) {
                console.log(res);
                if(res.errno == 0){
                    var meduList = res.data;
                    var option = '';
                    for(var i in meduList){
                        var medu = meduList[i];
                        option += '<option value="'+medu.id+'">'+medu.dish_name+'</option>';
                    }
                    var $option = $(option);
                    $('#medu_select').append($option);
                }
            },
            fail:function () {
                console.log('fail');
            }
        })
    }
</script>
