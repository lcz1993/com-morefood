<style>
    .hide{
        display: none;
    }
</style>
<div class="modal-dialog ">
    <form method="post" class="form-horizontal" action="/admin/discount/add" data-validate="parsley">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">{{controller.meta_title}}</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="col-sm-3 control-label">优惠券名称</label>
                    <div class="col-sm-9">
                        <div class="row">
                            <div class="col-md-8 ">
                                <input type="text" name="name" class="input-sm form-control" placeholder="优惠券名称" data-required="true">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">开始时间</label>
                    <div class="col-sm-9">
                        <div class="row">
                            <div class="col-md-8 ">
                                <input type="text" name="start_time" class="input-sm form-control date" placeholder="使用期限开始时间">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">结束时间</label>
                    <div class="col-sm-9">
                        <div class="row">
                            <div class="col-md-8 ">
                                <input type="text" name="end_time" class="input-sm form-control date" placeholder="使用期限结束时间">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">优惠券状态</label>
                    <div class="col-sm-9">
                        <div class="row">
                            <div class="col-md-8 ">
                                <label>正常</label>
                                <input type="radio" name="status" value="0" checked="checked" />
                                <label>过期</label>
                                <input type="radio" name="status" value="1"/>    <!--默认选中-->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">正在使用</label>
                    <div class="col-sm-9">
                        <div class="row">
                            <div class="col-md-8 ">
                                <label>是</label>
                                <input type="radio" name="is_show" value="0"/>
                                <label>否</label>
                                <input type="radio" name="is_show" value="1" checked="checked" />    <!--默认选中-->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">发放平台</label>
                    <div class="col-sm-9">
                        <div class="row">
                            <div class="col-md-8 ">
                                <label>是</label>
                                <input type="radio" name="distribution_platform" value="1" checked="checked"/><!--默认选中-->
                                <label>否</label>
                                <input type="radio" name="distribution_platform" value="2"  />
                                <label>否</label>
                                <input type="radio" name="distribution_platform" value="3"/>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-3 control-label">优惠券种类</label>
                    <div class="col-sm-9">
                        <div class="row">
                            <div class="col-md-8 ">
                                <select class="form-control input-sm" name="type_id" onchange="show()" id="type">
                                    <option value="" selected>-=-请选择-=-</option>
                                    {% for index, item in config.setupapp.DISCOUNT_TYPE%}
                                    <option value="{{index}}">{{item}}</option>
                                    {% endfor %}
                                    <!--<option value="4" >满赠</option>-->
                                </select>
                            </div>
                        </div>
                    </div>
                </div>



                <div class="hide" id="discount_3">
                    <div class="form-group  " >
                        <label class="col-sm-3 control-label">满</label>
                        <div class="col-sm-9">
                            <div class="row">
                                <div class="col-md-8 ">
                                    <input type="text" name="min_price_3" class="input-sm form-control number" placeholder="满">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group " >
                        <label class="col-sm-3 control-label">赠送</label>
                        <div class="col-sm-9">
                            <div class="row">
                                <div class="col-md-8 ">
                                    <input type="text" name="gift_goods" class="input-sm form-control" placeholder="赠送">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="hide" id="discount_5">
                    <div class="form-group  " >
                        <label class="col-sm-3 control-label">满</label>
                        <div class="col-sm-9">
                            <div class="row">
                                <div class="col-md-8 ">
                                    <input type="text" name="min_price_5" class="input-sm form-control number" placeholder="满">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group " >
                        <label class="col-sm-3 control-label">折扣</label>
                        <div class="col-sm-9">
                            <div class="row">
                                <div class="col-md-8 ">
                                    <div class="input-group">
                                        <input type="text" class="form-control" name="percent" id="percent" placeholder="折扣">
                                        <div class="input-group-addon">%</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="hide" id="discount_1">
                    <div class="form-group  " id="min_price">
                        <label class="col-sm-3 control-label">满</label>
                        <div class="col-sm-9">
                            <div class="row">
                                <div class="col-md-8 ">
                                    <input type="text" name="min_price_1" class="input-sm form-control number" placeholder="满">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group " id="cut_price">
                        <label class="col-sm-3 control-label">减</label>
                        <div class="col-sm-9">
                            <div class="row">
                                <div class="col-md-8 ">
                                    <input type="text" name="cut_price_1" class="input-sm form-control number" placeholder="减">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>



                <div class="hide" id="discount_2">
                    <div class="form-group" id="dish_class">
                        <label class="col-sm-3 control-label">分类</label>
                        <div class="col-sm-9">
                            <div class="row">
                                <div class="col-md-8 ">
                                    <select class="form-control input-sm" name="medu_dish_class" onchange="showMedu()" id="dish_class_list">

                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" id="medu_div">
                        <label class="col-sm-3 control-label">菜单</label>
                        <div class="col-sm-9">
                            <div class="row">
                                <div class="col-md-8 ">
                                    <select class="form-control input-sm" name="medu_id" id="medu_select">

                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--<div class="form-group" id="min_price_4">-->
                        <!--<label class="col-sm-3 control-label">最低消费限制</label>-->
                        <!--<div class="col-sm-9">-->
                            <!--<div class="row">-->
                                <!--<div class="col-md-8 ">-->
                                    <!--<input type="text" name="min_price_4" class="input-sm form-control number" placeholder="最低消费限制">-->
                                <!--</div>-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</div>-->
                    <div class="form-group" id="discount_orgin_price">
                        <label class="col-sm-3 control-label">单品特价</label>
                        <div class="col-sm-9">
                            <div class="row">
                                <div class="col-md-8 ">
                                    <input type="text" name="medu_origin_price" class="input-sm form-control number" placeholder="单品特价">
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--<div class="form-group "  id="discount_2_max_count">-->
                        <!--<label class="col-sm-3 control-label">发放数量</label>-->
                        <!--<div class="col-sm-9">-->
                            <!--<div class="row">-->
                                <!--<div class="col-md-8 ">-->
                                    <!--<input type="text" name="max_count_2" class="input-sm form-control number" placeholder="发放数量">-->
                                <!--</div>-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</div>-->
                </div>



                <!--<div class="hide" id="discount_4">-->
                    <!--<div class="form-group  " >-->
                        <!--<label class="col-sm-3 control-label">满</label>-->
                        <!--<div class="col-sm-9">-->
                            <!--<div class="row">-->
                                <!--<div class="col-md-8 ">-->
                                    <!--<input type="text" name="min_price_4" class="input-sm form-control number" placeholder="满">-->
                                <!--</div>-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</div>-->
                    <!--<div class="form-group " >-->
                        <!--<label class="col-sm-3 control-label">返现</label>-->
                        <!--<div class="col-sm-9">-->
                            <!--<div class="row">-->
                                <!--<div class="col-md-8 ">-->
                                    <!--<input type="text" name="cut_price_4" class="input-sm form-control number" placeholder="返现">-->
                                <!--</div>-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</div>-->
                <!--</div>-->


                <!--<div class="hide" id="discount_4">-->
                    <!--<div class="form-group  " >-->
                        <!--<label class="col-sm-3 control-label">最低使用金额</label>-->
                        <!--<div class="col-sm-9">-->
                            <!--<div class="row">-->
                                <!--<div class="col-md-8 ">-->
                                    <!--<input type="text" name="min_price_4" class="input-sm form-control number" placeholder="最低使用金额">-->
                                <!--</div>-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</div>-->
                    <!--<div class="form-group " >-->
                        <!--<label class="col-sm-3 control-label">返现金额</label>-->
                        <!--<div class="col-sm-9">-->
                            <!--<div class="row">-->
                                <!--<div class="col-md-8 ">-->
                                    <!--<input type="text" name="cut_price_4" class="input-sm form-control number" placeholder="红包金额">-->
                                <!--</div>-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</div>-->
                <!--</div>-->

                <div class="hide" id="discount_4">
                    <div class="form-group">
                        <label class="col-sm-3 control-label">满</label>
                        <div class="col-sm-9">
                            <div class="row">
                                <div class="col-md-8 ">
                                    <input type="text" name="min_price_4" class="input-sm form-control number" placeholder="满">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group " id="cut_price_4">
                        <label class="col-sm-3 control-label">返现</label>
                        <div class="col-sm-9">
                            <div class="row">
                                <div class="col-md-8 ">
                                    <input type="text" name="cut_price_4" class="input-sm form-control number" placeholder="返现">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="form-group " >
                    <label class="col-sm-3 control-label">发放数量</label>
                    <div class="col-sm-9">
                        <div class="row">
                            <div class="col-md-8 ">
                                <input type="text" name="max_count" value="5" class="input-sm form-control number" placeholder="发放数量">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="line line-dashed b-b line-lg pull-in"></div>
                <div class="form-group">
                    <label class="col-sm-2 control-label"><i class="fa fa-asterisk text-danger"></i> 使用规则详情</label>
                    <div class="col-sm-10">
                        <div class="row">
                            <div class="col-sm-10">
                                {{HOOKS@adminEdit@1.desc|safe}}
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <a href="javascript:;" class="btn btn-default" data-dismiss="modal">关闭</a>
                <button class="btn btn-primary btn-s-md ajax-post" type="submit" target-form="form-horizontal">确定</button>
            </div>
        </div><!-- /.modal-content -->
    </form>
</div><!-- /.modal-dialog -->
<script src="/static/admin/js/datepicker/bootstrap-datetimepicker.min.js" type="text/javascript"></script>
<script src="/static/admin/js/datepicker/locales/bootstrap-datetimepicker.zh-CN.js" type="text/javascript"></script>
<script>
    $(function () {
        $('.date').datetimepicker({
            format: 'yyyy-mm-dd HH:ii:ss',
            language:"zh-CN",
            minView:2,
            autoclose:true
        });
    })
    function show() {
        var type = $('#type option:selected').val();
        if(parseInt(type) === 1){
            //新用户优惠
            $("#discount_1").removeClass('hide');
            $("#discount_2").addClass('hide');
            $("#discount_3").addClass('hide');
            $("#discount_orgin_price").removeClass('hide');
            $("#discount_4").addClass('hide');
            $("#discount_5").addClass('hide');
        }else if(parseInt(type) === 2){
            //特价商品
            getDishClass();
            $("#discount_1").addClass('hide');
            $("#discount_2").removeClass('hide');
            $("#discount_3").addClass('hide');
            $("#discount_orgin_price").removeClass('hide');
            $("#discount_4").addClass('hide');
            $("#discount_5").addClass('hide');
            $("#discount_6").addClass('hide');
            $("#discount_2_max_count").removeClass('hide');
        }else if(parseInt(type) === 3){
            //下单立减
            $("#discount_1").addClass('hide');
            $("#discount_2").addClass('hide');
            $("#discount_3").removeClass('hide');
            $("#discount_orgin_price").addClass('hide');
            $("#discount_4").addClass('hide');
            $("#discount_5").addClass('hide');
        }else if(parseInt(type) === 4){
            //赠品优惠
            getDishClass();
            $("#discount_1").addClass('hide');
            $("#discount_2").addClass('hide');
            $("#discount_3").addClass('hide');
            $("#discount_orgin_price").addClass('hide');
            $("#discount_2_max_count").addClass('hide');
            $("#discount_4").removeClass('hide');
            $("#discount_5").addClass('hide');
        }else if(parseInt(type) === 5){
            //下单返红包
            $("#discount_1").addClass('hide');
            $("#discount_2").addClass('hide');
            $("#discount_3").addClass('hide');
            $("#discount_orgin_price").addClass('hide');
            $("#discount_4").addClass('hide');
            $("#discount_5").removeClass('hide');
        }
    }
    function getDishClass() {
        $('dish_class_list').empty();
        $.ajax({
            url:'/admin/dishclass/list',
            type:'get',
            success:function (res) {
                console.log(res);
                if(res.errno == 0){
                    var dishClassList = res.data;
                    var dish = '';
                    for(var i in dishClassList){
                        var dishClass = dishClassList[i];
                        dish += '<option value="'+dishClass.id+'">'+dishClass.name+'</option>';
                    }
                    var $dish = $(dish);
                    $('#dish_class_list').append($dish);
                }
            },
            fail:function () {
                console.log('fail');
            }
        })
    }
    function showMedu(){
        $('#medu_select').empty();
        var id = $('#dish_class_list option:selected').val();
        $.ajax({
            url:'/admin/medu/list?dishClassId='+id,
            type:'get',
            success:function (res) {
                console.log(res);
                if(res.errno == 0){
                    var meduList = res.data;
                    var option = '';
                    for(var i in meduList){
                        var medu = meduList[i];
                        option += '<option value="'+medu.id+'">'+medu.dish_name+'</option>';
                    }
                    var $option = $(option);
                    $('#medu_select').append($option);
                }
            },
            fail:function () {
                console.log('fail');
            }
        })
    }
</script>
